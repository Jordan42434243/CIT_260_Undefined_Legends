<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <title>Register for Exams • CSN Exam Registration</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="../static/styles.css" rel="stylesheet">
</head>

<body>
  
  <header class="header">
    <div class="header__inner">
      <div><strong>Exam Registration</strong></div>
      <nav class="header__nav">
        <a href="my_reservations">My Reservations</a>
        <a href="{{ url_for('logout') }}">Logout</a>
		<span class="user-info">{{ first_name }} {{ last_name }}</span>
      </nav>
    </div>
  </header>

  <main class="main grid grid--2">


    <!-- Make a Reservation -->
    <section id="make-reservation" class="card">
      <h2 class="card__title">Make a Reservation</h2>

      <form class="form" method="post" action="{{ url_for('register_exam') }}">

        <!-- 0) Select Class -->
        <div class="form__row">
          <label class="label" for="class">Exam</label>
          <select id="exam_dropdown" name="exam_name" class="select" required>
            <option value="" disabled selected hidden>— Select Exam —</option>
            {% for exam_name in exam_names %}
            <option value="{{ exam_name }}">{{ exam_name }}</option>
            {% endfor %}
          </select>
          <div class="help">You may hold up to 3 different exams.</div>

                 
        <div class="form__row">
          <label class="label" for="class">Session ID</label>
          <select id="id_dropdown" name="exam_id" class="select" required>
            <option value="" disabled selected hidden>— Select ID —</option>
            {% for exam in exams %}
            <option value="{{ exam.exam_id }}" data-exam-name="{{exam.exam_name}}">{{ exam.exam_id }}</option>
            {% endfor %}
          </select>
          

        </div>
        </div>

      <table id="session_table" border="1">
        <thread>
          <tr>
            <th>ID</th>
            <th>Name</th>
            <th>Date/Time</th>
            <th>Location</th>
            <th>Proctor</th>
            <th>Capacity</th>
            <th>Current</th>
          </tr>
        </thread>
        <tbody>
          {% for exam in exams %}
          <tr data-exam_name="{{exam.exam_name}}">
            <td>{{ exam.exam_id }}</td>
            <td>{{ exam.exam_name }}</td>
            <td>{{ exam.exam_datetime }}</td>
            <td>{{ exam.exam_location }}</td>
            <td>{{ exam.exam_proctor }}</td>
            <!-- Capacity minus number registered -->
			<td>{{ exam.exam_capacity - exam.exam_current }}</td>
			<!-- How many are registered -->
			<td>{{ exam.exam_current }}</td>
          </tr>
          {% else %}
          <tr>
            <td colspan="7">No exams scheduled.</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>

        <!-- Hidden student id if needed by your server -->
        <input type="hidden" name="student_id" value="{{ student_id }}">

        <button class="button" type="submit">Confirm Reservation</button>
        {% if error %}<label class="label error">{{ error }}</label>{% endif %}
        <p class="help">You cannot book the same exam twice. Capacity limits apply per session.</p>
      </form>
    </section>


  </main>

  <footer class="footer">© CSN Testing Center</footer>

 
 <script>
  const examDropdown = document.getElementById("exam_dropdown");
  const idDropdown = document.getElementById("id_dropdown");
  const sessions = document.querySelectorAll("#session_table tr[data-exam_name]");


  examDropdown.addEventListener("change", function() {

    const selectedExam = examDropdown.value;

    sessions.forEach(session => {
      const sessionExamName = session.dataset.exam_name;

      if (sessionExamName === selectedExam) {
        session.style.display = "";
      } else {
        session.style.display = "none";
      }
    });
  });

  examDropdown.addEventListener("change", function() {


    const idOptions = idDropdown.querySelectorAll("option");
    const selectedExam = examDropdown.value;

    idOptions.forEach(option => {
    if (option.dataset.examName === selectedExam) {
      option.style.display = "";
    } else {
       option.style.display = "none";
    }
      });
  });
 </script>
</body>
</html>

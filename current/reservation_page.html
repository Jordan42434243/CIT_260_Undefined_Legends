<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>My Reservations • CSN Exam Registration</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="styles.css" rel="stylesheet">
</head>
<body>
  <header class="header">
    <div class="header__inner">
      <div><strong>My Reservations</strong></div>
      <nav class="header__nav">
        <a href="{{ url_for('dashboard') }}">Dashboard</a>
        <a href="{{ url_for('logout') }}">Logout</a>
		<span class="user-info">{{ first_name }} {{ last_name }}</span>
      </nav>
    </div>
  </header>

  <main class="main">
    <!-- Filter Bar -->
    <section class="card">
      <h2 class="card__title">Filter</h2>
      <form class="form grid grid--3" method="get" action="{{ url_for('my_reservations') }}">
        <!-- Subject -->
        <div class="form__row">
          <label class="label" for="subject">Subject</label>
          <select id="subject" name="subject" class="select">
            <option value="">Any</option>
            <option value="Math"             {% if request.args.get('subject') == 'Math' %}selected{% endif %}>Math</option>
            <option value="English"          {% if request.args.get('subject') == 'English' %}selected{% endif %}>English</option>
            <option value="Computer Science" {% if request.args.get('subject') == 'Computer Science' %}selected{% endif %}>Computer Science</option>
          </select>
        </div>

        <!-- Time (timeslot strings provided by backend, e.g., "2025-10-30 09:00 AM") -->
        <div class="form__row">
          <label class="label" for="time">Time</label>
          <select id="time" name="time" class="select">
            <option value="">Any</option>
            {% for t in available_times %}
              <option value="{{ t }}" {% if request.args.get('time') == t %}selected{% endif %}>{{ t }}</option>
            {% endfor %}
          </select>
        </div>

        <!-- Location -->
        <div class="form__row">
          <label class="label" for="location">Location</label>
          <select id="location" name="location" class="select">
            <option value="">Any</option>
            <option value="Charleston" {% if request.args.get('location') == 'Charleston' %}selected{% endif %}>Charleston</option>
            <option value="Henderson"  {% if request.args.get('location') == 'Henderson' %}selected{% endif %}>Henderson</option>
          </select>
        </div>

        <div class="form__row" style="grid-column: 1 / -1;">
          <button class="button" type="submit">Apply filters</button>
          <a class="button button--ghost" href="{{ url_for('my_reservations') }}" style="margin-left:8px;">Reset</a>
        </div>
      </form>
    </section>

    <!-- Results -->
    <section class="card">
      <h3 class="card__title">Your Reservations</h3>
      <table class="table">
        <thead>
          <tr>
            <th>Subject</th>
            <th>Exam</th>
            <th>Time</th>
            <th>Location</th>
            <th>Room</th>
            <th>Proctor</th>
            <th>Status</th>
            <th style="width: 1%;">Actions</th>
          </tr>
        </thead>
        <tbody>
          {% if my_reservations and my_reservations|length > 0 %}
            {% for r in my_reservations %}
              <tr>
                <td>{{ r.class_name }}</td>
                <td>{{ r.exam_title }}</td>
                <td>{{ r.when_human }}</td>
                <td>{{ r.location }}</td>
                <td>{{ r.room }}</td>
                <td>{{ r.proctor_name }}</td>
                <td>
                  {% if r.active %}
                    <span class="status status--ok">Active</span>
                  {% else %}
                    <span class="status">Cancelled</span>
                  {% endif %}
                </td>
                <td>
                  {% if r.active %}
                    <form method="post" action="{{ url_for('cancel') }}">
                      <input type="hidden" name="registration_id" value="{{ r.id }}">
                      <button class="button button--ghost" type="submit" title="Cancel this reservation">Cancel</button>
                    </form>
                  {% else %}
                    —
                  {% endif %}
                </td>
              </tr>
            {% endfor %}
          {% else %}
            <tr>
              <td colspan="8" class="help">No reservations match your filters.</td>
            </tr>
          {% endif %}
        </tbody>
      </table>
    </section>
  </main>

  <footer class="footer">© CSN Testing Center</footer>
</body>
</html>
